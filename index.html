<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Yo</title>
  <link rel="stylesheet" href="styles/main.css">
  <script src="scripts/n3.js"></script>
  <script src="scripts/YoSource.js"></script>
</head>
<body>
  <header>
    <h1>Yo</h1>
    <p>Send a <q>Yo</q> to a person of your choice.</p>
  </header>
  <main>
    <h2>Source</h2>
    <p>
      <label for="source">Yo source:</label>
      <input id="source" value="data/yo.ttl" />
    </p>
    <h2>Random Yo</h2>
    <div class="yo">
      <p>
        <span id="from">anonymous</span>
        sent a Yo to
        <span id="to">anonymous</span>.
      </p>
    </div>
    <h2>Send a Yo</h2>
    <form>
      <p>
        <label for="recipient">Send a Yo to</label>
        <input id="recipient" />
      </p>
      <p>
        <input type="button" id="send" value="Send" />
      </p>
    </form>
  </main>
  <script>
    // Collect DOM elements
    const elements = {};
    ['source', 'from', 'to', 'recipient', 'send'].forEach(name =>
      elements[name] = document.getElementById(name));

    // Sets the data source based on the field value
    let source;
    function updateSource() {
      source = new YoSource(elements.source.value);
      displayRandomYo();
    }
    updateSource();
    // Update data source on change
    elements.source.addEventListener('change', updateSource);

    // Displays a random Yo
    async function displayRandomYo() {
      const { from, to } = await source.getRandomYo();
      elements.from.innerText = await from;
      elements.to.innerText = await to;
    }

    // Add a Yo on click
    elements.send.addEventListener('click', async () => {
      const from = 'https://ruben.verborgh.org/profile/#me';
      const to = elements.recipient.value;
      try {
        await source.addYo({ from, to });
      }
      catch (error) {
        alert(`Could not send Yo: ${error.message}`);
      }
    });
  </script>
</body>
</html>
